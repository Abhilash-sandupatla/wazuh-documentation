.. _poc_vulnerability_detector:


Vulnerability Detector
======================

Wazuh can detect if installed applications do have an unpatched CVE in the monitored system. Check :ref:`Audit Configuration Guide <vulnerability-detection>` documentation for further information about this.

Configuration on the Wazuh manager
Enable vulnerability detector wodle in ``/var/ossec/etc/ossec.conf``

    .. code-block:: XML

        <ossec_config>
        <vulnerability-detector>
            <enabled>yes</enabled>
            <interval>5m</interval>
            <ignore_time>6h</ignore_time>
            <run_on_start>yes</run_on_start>

            <!-- Ubuntu OS vulnerabilities -->
            <provider name="canonical">
            <enabled>yes</enabled>
            <os>trusty</os>
            <os>xenial</os>
            <os>bionic</os>
            <os>focal</os>
            <update_interval>1h</update_interval>
            </provider>

            <!-- Debian OS vulnerabilities -->
            <provider name="debian">
            <enabled>yes</enabled>
            <os>stretch</os>
            <os>buster</os>
            <update_interval>1h</update_interval>
            </provider>

            <!-- RedHat OS vulnerabilities -->
            <provider name="redhat">
            <enabled>yes</enabled>
            <os>5</os>
            <os>6</os>
            <os>7</os>
            <os>8</os>
            <update_interval>1h</update_interval>
            </provider>

            <!-- Windows OS vulnerabilities -->
            <provider name="msu">
            <enabled>yes</enabled>
            <update_interval>1h</update_interval>
            </provider>

            <!-- Aggregate vulnerabilities -->
            <provider name="nvd">
            <enabled>yes</enabled>
            <update_from_year>2010</update_from_year>
            <update_interval>1h</update_interval>
            </provider>

        </vulnerability-detector>
        </ossec_config>

Configuration on a Windows endpoint
-----------------------------------

In order to detect vulnerabilities on Windows endpoints, enable ``hotfixes`` and ``packages`` collection in the ``syscollector`` component. This can be done in the Wazuh agent configuration file ``/var/ossec/etc/ossec.conf``:

    .. code-block:: XML

        <wodle name="syscollector">
         <disabled>no</disabled>
         <interval>1h</interval>
         <scan_on_start>yes</scan_on_start>
         <hardware>yes</hardware>
         <os>yes</os>
         <network>yes</network>
         <packages>yes</packages>
         <hotfixes>yes</hotfixes>
         <ports all="no">yes</ports>
         <processes>yes</processes>
        </wodle>


Configuration on a Linux endpoint
---------------------------------

In order to detect vulnerabilities on Linux endpoints, enable the collection of software ``packages``  in the ``syscollector`` component. This can be done in the Wazuh agent configuration file ``/var/ossec/etc/ossec.conf``:

    .. code-block:: XML

        <wodle name="syscollector">
         <disabled>no</disabled>
         <interval>1h</interval>
         <scan_on_start>yes</scan_on_start>
         <hardware>yes</hardware>
         <os>yes</os>
         <network>yes</network>
         <packages>yes</packages>
         <ports all="no">yes</ports>
         <processes>yes</processes>
        </wodle> 


Steps to generate the alerts
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

A global vulnerability database, with the list of all ``CVEs`` check is created on the Wazuh manager at ``/var/ossec/queue/vulnerabilities/cve.db``.

Scans will be performed periodically, going through the list of applications collected for each monitored endpoint and looking for known vulnerabilities.

Alerts
^^^^^^

- ``rule.groups:vulnerability-detector``

Affected endpoints
^^^^^^^^^^^^^^^^^^

- Linux RHEL
- Windows