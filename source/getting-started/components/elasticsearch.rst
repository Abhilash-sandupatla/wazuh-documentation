.. Copyright (C) 2021 Wazuh, Inc.

.. _components_elasticsearch:

Elasticsearch
=============

Elasticsearch is a highly scalable, full-text search and analytics engine. This Wazuh central component indexes and stores alerts generated by the Wazuh server, and provides near real-time search and analytics. Elasticsearch can be configured as a single-node or multi-node cluster providing scale and high availability. 

Elasticsearch stores data as JSON documents. Each document correlates a set of keys, field names or properties, with their corresponding values which can be strings, numbers, Booleans, dates, arrays of values, geolocations, or other types of data.

The documents stored in Elasticsearch are distributed across different containers known as shards. By distributing the documents across multiple shards, and distributing those shards across multiple nodes, Elasticsearch can ensure redundancy. This protects your system against hardware failures and increases query capacity as nodes are added to a cluster. 

.. thumbnail:: ../../images/getting_started/elasticsearch.png
    :alt: Elasticsearch cluster
    :align: center
    :wrap_image: No


An Elasticsearch index is a collection of documents that are related to each other. Wazuh uses different indices for alerts data, raw events, status monitoring information, and performance-related data. 

Elasticsearch uses a data structure called inverted index, which is designed to allow quick full-text searches. An inverted index lists every unique word that appears in any document and identifies all of the documents that contain each particular word. During the indexing process, Elasticsearch stores documents and builds an inverted index to make the document data searchable in near real-time. Indexing is initiated with the index API, through which you can add or update a JSON document in a specific index.

Wazuh uses four different index patterns to store different event types.

.. |--| unicode:: U+02011 .. non-breaking dash
   :trim:

+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ 
| Index                           | Description                                                                                                                                                                                                                    |
+=================================+================================================================================================================================================================================================================================+
| **wazuh** |--| **alerts**       | Stores alerts generated by the :ref:`Wazuh server <wazuh_server>`. These are created each time an event trips a rule with a high enough priority (this threshold is configurable).                                             |
+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ 
| **wazuh** |--| **archives**     | Stores all events (archive data) received by the analysis engine, whether or not they trip a rule.                                                                                                                             |
+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ 
| **wazuh** |--| **monitoring**   | Stores data related to the :ref:`Wazuh agents <wazuh_agent>` status over time. It is used by the web interface to represent when individual agents are or have been ``Active``, ``Disconnected``, or ``Never connected``.      |
+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ 
| **wazuh** |--| **statistics**   | Stores data related to the Wazuh manager performance. It is used by the web interface to represent the daemons' statistics.                                                                                                    |
+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ 


Elasticsearch is well suited for time-sensitive use cases like security analytics and infrastructure monitoring as it's a near real-time search platform. The latency from the time a document is indexed until it becomes searchable is very short â€” typically one second.

You interact with the Elasticsearch clusters using the REST API, which offers a lot of flexibility. You can perform searches, add or delete documents, modify indices, and more. Elasticsearch comes with a wide set of features. In addition to its speed, scalability, and resiliency, Elasticsearch has several powerful built-in features that make storing and searching data even more efficient, such as data rollups, alerting, anomaly detection and index lifecycle management.

